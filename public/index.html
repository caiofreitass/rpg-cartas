<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>RPG Multiplayer</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #eee; margin: 0; padding: 0; }
  #messages { height: 400px; overflow-y: auto; border: 1px solid #444; padding: 10px; margin: 10px; background: #222; }
  #players { margin: 10px; padding: 10px; border: 1px solid #444; background: #222; }
  #inputDiv { margin: 10px; }
  input, select, button { padding: 5px; font-size: 16px; }
</style>
</head>
<body>

<h2>RPG Multiplayer - Chat de Mensagens</h2>

<div id="players"></div>

<div id="messages"></div>

<div id="inputDiv">
  <input type="text" id="nameInput" placeholder="Digite seu nome">
  <select id="abilityInput"></select>
  <select id="target"></select>
  <button id="sendBtn">Usar Habilidade</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();

let myId = null;
let players = {};
let currentTurn = null;

// Elementos
const messagesEl = document.getElementById("messages");
const playersEl = document.getElementById("players");
const abilityEl = document.getElementById("abilityInput");
const targetEl = document.getElementById("target");
const sendBtn = document.getElementById("sendBtn");
const nameInput = document.getElementById("nameInput");

// Habilidades por classe
const abilitiesByClass = {
  "Lobisomem": [
    "Ataque Selvagem",
    "Garras Rasgantes",
    "Investida",
    "Uivo Assustador",
    "RegeneraÃ§Ã£o"
  ],
  "Vampiro": [
    "Suga Vida",
    "Investida Noturna",
    "Encanto",
    "Mordida VampÃ­rica",
    "Neblina Sombria"
  ],
  "Bruxa": [
    "Bola de Fogo",
    "Raio Congelante",
    "MaldiÃ§Ã£o",
    "PoÃ§Ã£o Curativa",
    "Espinho Venenoso"
  ]
};

// Perguntar nome
nameInput.addEventListener("change", ()=>{
  socket.emit("setName", nameInput.value);
});

// Receber escolha de classe
socket.on("chooseClass", (classes)=>{
  let chosen = prompt(`Escolha sua classe: ${classes.join(", ")}`);
  while(!classes.includes(chosen)){
    chosen = prompt(`Classe invÃ¡lida! Escolha entre: ${classes.join(", ")}`);
  }
  socket.emit("setClass", chosen);
});

// InicializaÃ§Ã£o
socket.on("init",(data)=>{
  myId = data.id;
  players = data.players;
  currentTurn = data.currentTurn;
  renderPlayers();
  updateAbilityOptions();
});

// AtualizaÃ§Ã£o de jogadores
socket.on("updatePlayers",(data)=>{
  players = data;
  renderPlayers();
  updateAbilityOptions();
});

// AtualizaÃ§Ã£o de turno
socket.on("turnChanged",(id)=>{
  currentTurn = id;
  renderPlayers();
});

// Mensagens
socket.on("message",(msg)=>{
  messagesEl.innerHTML += `<div>${msg}</div>`;
  messagesEl.scrollTop = messagesEl.scrollHeight;
});

// Renderizar jogadores
function renderPlayers(){
  playersEl.innerHTML = "<b>Jogadores:</b><br>";
  for(let id in players){
    const p = players[id];
    let label = `${p.name} (${p.classe}) - HP: ${p.hp} ${p.alive ? "" : "(Morto)"}`;
    if(id===currentTurn) label += " ðŸ”¹";
    playersEl.innerHTML += `<div>${label}</div>`;
  }

  // Atualizar opÃ§Ãµes de alvo
  targetEl.innerHTML = "";
  for(let id in players){
    if(players[id].alive && id!==myId){
      const opt = document.createElement("option");
      opt.value = id;
      opt.innerText = players[id].name;
      targetEl.appendChild(opt);
    }
  }
}

// Atualizar opÃ§Ãµes de habilidades com nomes
function updateAbilityOptions(){
  const myPlayer = players[myId];
  if(!myPlayer) return;
  abilityEl.innerHTML = "";
  const abilities = abilitiesByClass[myPlayer.classe];
  abilities.forEach((name, i)=>{
    const opt = document.createElement("option");
    opt.value = i+1;
    opt.innerText = `${i+1} - ${name}`;
    abilityEl.appendChild(opt);
  });
}

// Usar habilidade
sendBtn.addEventListener("click", ()=>{
  if(currentTurn !== myId){
    alert("NÃ£o Ã© sua vez!");
    return;
  }
  const ability = parseInt(abilityEl.value);
  const targetId = targetEl.value;
  if(!targetId){
    alert("Escolha um alvo vÃ¡lido!");
    return;
  }
  socket.emit("playAbility",{targetId, abilityIndex:ability});
});
</script>

</body>
</html>
